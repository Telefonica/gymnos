version: "2.0"
services:
    spark-master:
        image: bde2020/spark-master:2.4.0-hadoop2.7
        ports:
            - "8080:8080"
            - "7077:7077"
        environment:
            - INIT_DAEMON_STEP=setup_spark
        volumes:
            - "./data:/tmp/data"
    spark-worker-1:
        image: bde2020/spark-worker:2.4.0-hadoop2.7
        links:
          - spark-master
        ports:
            - "8081:8081"
        environment:
            - "SPARK_MASTER=spark://spark-master:7077"
        volumes:
            - "./data:/tmp/data"
    gymnos:
        build: .
        links:
            - spark-master
        volumes:
            - "./data:/tmp/data"
            - "./cache:/usr/src/app/cache"
            - "./cache/keras:/root/.keras"
        depends_on:
            - spark-master
            - spark-worker-1
        environment:
            - KAGGLE_USERNAME=<kaggle_username>
            - KAGGLE_KEY=<kaggle_key>
        entrypoint: python3 -m bin.scripts.gymnosd
